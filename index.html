<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ContIA</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #1a1a1a;
        color: #ffffff;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .container {
        width: 100%;
        max-width: 600px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 40px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 32px;
        font-weight: bold;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .logo-icon::before {
        content: "";
        width: 20px;
        height: 20px;
        border: 3px solid #1a1a1a;
        border-radius: 50%;
        border-top-color: transparent;
        border-right-color: transparent;
        transform: rotate(-45deg);
      }

      .logo-icon::after {
        content: "";
        position: absolute;
        width: 8px;
        height: 8px;
        background: #1a1a1a;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .chat-container {
        width: 100%;
        height: 400px;
        background-color: #2a2a2a;
        border-radius: 16px;
        padding: 20px;
        overflow-y: auto;
        margin-bottom: 20px;
      }

      .message {
        margin-bottom: 15px;
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 80%;
        word-wrap: break-word;
      }

      .user-message {
        background-color: #4a90e2;
        color: #ffffff;
        margin-left: auto;
        text-align: right;
      }

      .bot-message {
        background-color: #3a3a3a;
        color: #ffffff;
        margin-right: auto;
      }

      .input-container {
        width: 100%;
        position: relative;
      }

      .main-input {
        width: 100%;
        min-height: 60px;
        max-height: 200px;
        background-color: #2a2a2a;
        border: none;
        border-radius: 16px;
        padding: 20px 90px 20px 60px;
        color: #ffffff;
        font-size: 16px;
        outline: none;
        position: relative;
        word-wrap: break-word;
        overflow-wrap: break-word;
        resize: none;
        font-family: inherit;
        line-height: 1.4;
        overflow-y: auto;
      }

      .main-input::placeholder {
        color: #888888;
      }

      .input-left-controls {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .mic-button {
        width: 32px;
        height: 32px;
        background-color: #3a3a3a;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #ffffff;
      }

      .mic-button::before {
        content: "ðŸŽ¤";
        font-size: 14px;
      }

      .fast-dropdown {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #888888;
        font-size: 14px;
        cursor: pointer;
      }

      .fast-dropdown::before {
        content: "âš¡";
        font-size: 12px;
      }

      .fast-dropdown::after {
        content: "â–¼";
        font-size: 10px;
      }

      .input-right-controls {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
      }

      .waveform-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888888;
      }

      .waveform-icon::before {
        content: "ðŸ“Š";
        font-size: 16px;
      }


      .send-button {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        height: 45px;
        width: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2px;
        border-radius: 50%;
        border: 1px solid transparent;
        border-style: inset;
        transition: all 100ms;
        background-color: #FCFCFC;
        color: #111113;
        cursor: pointer;
        font-size: 16px;
        overflow: hidden;
        z-index: 10;
      }

      .send-button.visible {
        display: block;
      }

      .bottom-buttons {
        display: flex;
        gap: 15px;
        width: 100%;
        justify-content: center;
      }

      .bottom-button {
        background-color: #2a2a2a;
        border: none;
        border-radius: 12px;
        padding: 12px 20px;
        color: #ffffff;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.2s;
      }

      .bottom-button:hover {
        background-color: #3a3a3a;
      }

      .bottom-button::before {
        font-size: 16px;
      }

      .edit-image::before {
        content: "ðŸ“·";
      }

      .latest-news::before {
        content: "ðŸ“°";
      }

      .personalities::before {
        content: "ðŸ‘¤";
      }

      .personalities::after {
        content: "â–¼";
        font-size: 10px;
        margin-left: 4px;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #ffffff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="logo">
        ContIA
      </div>

      <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
          OlÃ¡! Como posso ajudar vocÃª hoje? ðŸ‘‹
        </div>
      </div>

      <div class="input-container">
        <textarea
          class="main-input"
          placeholder="O que vocÃª quer saber?"
          id="messageInput"
          rows="1"
          resize="none"
        ></textarea>

        <button class="send-button" id="sendButton">âž¤</button>
      </div>

      <!-- <div class="bottom-buttons">
        <button class="bottom-button edit-image">Editar imagem</button>
        <button class="bottom-button latest-news">
          NotÃ­cias mais recentes
        </button>
        <button class="bottom-button personalities">Personalidades</button>
      </div>
    </div> -->

    <script>
      const messageInput = document.getElementById("messageInput");
      const sendButton = document.getElementById("sendButton");
      const chatContainer = document.getElementById("chatContainer");
      const webhookUrl =
        "https://n8n.srv934741.hstgr.cloud/webhook/9c3ff848-cbf4-4846-9289-0a0b8381c121/chat";

      // FunÃ§Ã£o para ajustar altura do textarea
      function adjustTextareaHeight() {
        messageInput.style.height = 'auto';
        messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
      }

      // Mostrar/ocultar botÃ£o de enviar baseado no conteÃºdo do input
      messageInput.addEventListener("input", function () {
        adjustTextareaHeight();
        if (this.value.trim()) {
          sendButton.classList.add("visible");
        } else {
          sendButton.classList.remove("visible");
        }
      });

      // FunÃ§Ã£o para adicionar mensagem ao chat
      function addMessage(text, isUser = false) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${
          isUser ? "user-message" : "bot-message"
        }`;
        messageDiv.textContent = text;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // FunÃ§Ã£o para enviar mensagem para o webhook
      async function sendMessage(message) {
        try {
          const response = await fetch(webhookUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: message,
            }),
          });

          if (response.ok) {
            console.log("Response OK - Status:", response.status);
            
            let data;
            try {
              data = await response.json();
              console.log("Resposta completa do n8n:", data);
            } catch (jsonError) {
              console.error("Erro ao fazer parse do JSON:", jsonError);
              const textResponse = await response.text();
              console.log("Resposta como texto:", textResponse);
              return "Erro no formato da resposta do servidor";
            }
            
            console.log("Status da resposta:", response.status);
            console.log("Headers da resposta:", response.headers);
            
            // Tenta diferentes campos possÃ­veis da resposta
            const responseText = data.output || 
                               data.response || 
                               data.message || 
                               data.text || 
                               data.content || 
                               data.answer ||
                               "Obrigado pela sua mensagem!";
            
            console.log("Texto extraÃ­do:", responseText);
            return responseText;
          } else {
            console.error("Erro HTTP:", response.status, response.statusText);
            console.error("Response headers:", response.headers);
            const errorText = await response.text();
            console.error("Response body:", errorText);
            throw new Error(`Erro na resposta do servidor: ${response.status}`);
          }
        } catch (error) {
          console.error("Erro ao enviar mensagem:", error);
          return "Desculpe, ocorreu um erro ao processar sua mensagem.";
        }
      }

      // FunÃ§Ã£o para enviar mensagem
      async function handleSendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;

        // Adicionar mensagem do usuÃ¡rio
        addMessage(message, true);
        messageInput.value = "";
        sendButton.classList.remove("visible");

        // Mostrar loading
        const loadingDiv = document.createElement("div");
        loadingDiv.className = "message bot-message";
        loadingDiv.innerHTML = '<span class="loading"></span> Processando...';
        chatContainer.appendChild(loadingDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // Enviar para o webhook
        const response = await sendMessage(message);

        // Remover loading
        chatContainer.removeChild(loadingDiv);

        // Adicionar resposta do bot
        addMessage(response);
      }

      // Event listeners
      sendButton.addEventListener("click", handleSendMessage);

      messageInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          handleSendMessage();
        }
      });

      // Focar no input ao carregar a pÃ¡gina
      messageInput.focus();
    </script>
  </body>
</html>
