<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ContIA</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #1a1a1a;
        color: #ffffff;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 24px;
        font-weight: bold;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .logo-icon::before {
        content: "";
        width: 16px;
        height: 16px;
        border: 2px solid #1a1a1a;
        border-radius: 50%;
        border-top-color: transparent;
        border-right-color: transparent;
        transform: rotate(-45deg);
      }

      .logo-icon::after {
        content: "";
        position: absolute;
        width: 6px;
        height: 6px;
        background: #1a1a1a;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .chat-container {
        flex: 1;
        background-color: #1a1a1a;
        padding: 5%;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }

      .message {
        margin-bottom: 15px;
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 80%;
        word-wrap: break-word;
      }

      .user-message {
        background-color: #4a90e2;
        color: #ffffff;
        margin-left: auto;
        text-align: right;
      }

      .bot-message {
        background-color: #272727;
        color: #ffffff;
        margin-right: auto;
      }

      .bot-message div {
        background-color: #333333;
        border-radius: 8px;
        border-left: 4px solid #69aaf5;
        padding: 15px;
        margin: 15px 0;
      }

      .bot-message a {
        color: #69aaf5;
      }

      /* Estilos para HTML renderizado nas mensagens do bot */
      .bot-message h1,
      .bot-message h2,
      .bot-message h3,
      .bot-message h4,
      .bot-message h5,
      .bot-message h6 {
        margin: 10px 0 8px 0;
        color: #ffffff;
      }

      .bot-message p {
        margin: 8px 0;
        line-height: 1.5;
      }

      .bot-message ul,
      .bot-message ol {
        margin: 8px 0;
        padding-left: 20px;
      }

      .bot-message li {
        margin: 4px 0;
        line-height: 1.4;
      }

      .bot-message table {
        width: 100%;
        margin: 10px 0;
        border-collapse: collapse;
        font-size: 14px;
        overflow-x: auto;
        display: block;
      }

      /* Responsividade para tabelas em telas pequenas */
      @media (max-width: 768px) {
        .bot-message table {
          font-size: 12px;
        }

        .bot-message th,
        .bot-message td {
          padding: 6px 8px;
        }
      }

      .bot-message th,
      .bot-message td {
        padding: 8px 12px;
        text-align: left;
        border: 1px solid #555;
      }

      .bot-message th {
        background-color: #4a4a4a;
        font-weight: bold;
      }

      .bot-message strong {
        font-weight: bold;
        color: #ffffff;
      }

      .bot-message em {
        font-style: italic;
      }

      .bot-message code {
        background-color: #2a2a2a;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 13px;
      }

      .input-section {
        /* background-color: #2a2a2a; */
        padding: 20px;
      }

      .input-container {
        width: 100%;
        position: relative;
        max-width: 800px;
        margin: 0 auto;
      }

      .main-input {
        width: 100%;
        min-height: 60px;
        max-height: 200px;
        background-color: #2a2a2a;
        border: none;
        border-radius: 16px;
        padding: 20px 90px 20px 60px;
        color: #ffffff;
        font-size: 16px;
        outline: none;
        position: relative;
        word-wrap: break-word;
        overflow-wrap: break-word;
        resize: none;
        font-family: inherit;
        line-height: 1.4;
        overflow-y: auto;
      }

      .main-input::placeholder {
        color: #888888;
      }

      .input-left-controls {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .mic-button {
        width: 32px;
        height: 32px;
        background-color: #4a4a4a;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #ffffff;
      }

      .mic-button::before {
        content: "üé§";
        font-size: 14px;
      }

      .fast-dropdown {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #888888;
        font-size: 14px;
        cursor: pointer;
      }

      .fast-dropdown::before {
        content: "‚ö°";
        font-size: 12px;
      }

      .fast-dropdown::after {
        content: "‚ñº";
        font-size: 10px;
      }

      .input-right-controls {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
      }

      .waveform-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888888;
      }

      .waveform-icon::before {
        content: "üìä";
        font-size: 16px;
      }

      .send-button {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        height: 45px;
        width: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2px;
        border-radius: 50%;
        border: 1px solid transparent;
        border-style: inset;
        transition: all 100ms;
        background-color: #fcfcfc;
        color: #111113;
        cursor: pointer;
        font-size: 16px;
        overflow: hidden;
        z-index: 10;
      }

      .send-button.visible {
        display: flex;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #ffffff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">ContIA</div>
    </div>

    <div class="chat-container" id="chatContainer">
      <div class="message bot-message">
        Ol√°! Como posso ajudar voc√™ hoje? üëã
      </div>
    </div>

    <div class="input-section">
      <div class="input-container">
        <textarea
          class="main-input"
          placeholder="O que voc√™ quer saber?"
          id="messageInput"
          rows="1"
          resize="none"
        ></textarea>

        <button class="send-button" id="sendButton">‚û§</button>
      </div>
    </div>

    <script>
      const messageInput = document.getElementById("messageInput");
      const sendButton = document.getElementById("sendButton");
      const chatContainer = document.getElementById("chatContainer");
      const webhookUrl =
        "https://n8n.srv934741.hstgr.cloud/webhook/9c3ff848-cbf4-4846-9289-0a0b8381c121/chat";

      // Fun√ß√£o para ajustar altura do textarea
      function adjustTextareaHeight() {
        messageInput.style.height = "auto";
        messageInput.style.height =
          Math.min(messageInput.scrollHeight, 200) + "px";
      }

      // Mostrar/ocultar bot√£o de enviar baseado no conte√∫do do input
      messageInput.addEventListener("input", function () {
        adjustTextareaHeight();
        if (this.value.trim()) {
          sendButton.classList.add("visible");
        } else {
          sendButton.classList.remove("visible");
        }
      });

      // Fun√ß√£o para adicionar mensagem ao chat
      function addMessage(text, isUser = false) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${
          isUser ? "user-message" : "bot-message"
        }`;

        // Para mensagens do usu√°rio, usar textContent para seguran√ßa
        // Para mensagens do bot, usar innerHTML para renderizar HTML
        if (isUser) {
          messageDiv.textContent = text;
        } else {
          messageDiv.innerHTML = text;
        }

        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // Fun√ß√£o para enviar mensagem para o webhook
      async function sendMessage(message) {
        try {
          const response = await fetch(webhookUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: message,
            }),
          });

          if (response.ok) {
            console.log("Response OK - Status:", response.status);

            let data;
            try {
              data = await response.json();
              console.log("Resposta completa do n8n:", data);
            } catch (jsonError) {
              console.error("Erro ao fazer parse do JSON:", jsonError);
              const textResponse = await response.text();
              console.log("Resposta como texto:", textResponse);
              return "Erro no formato da resposta do servidor";
            }

            console.log("Status da resposta:", response.status);
            console.log("Headers da resposta:", response.headers);

            // Tenta diferentes campos poss√≠veis da resposta
            const responseText =
              data.output ||
              data.response ||
              data.message ||
              data.text ||
              data.content ||
              data.answer ||
              "Obrigado pela sua mensagem!";

            console.log("Texto extra√≠do:", responseText);
            return responseText;
          } else {
            console.error("Erro HTTP:", response.status, response.statusText);
            console.error("Response headers:", response.headers);
            const errorText = await response.text();
            console.error("Response body:", errorText);
            throw new Error(`Erro na resposta do servidor: ${response.status}`);
          }
        } catch (error) {
          console.error("Erro ao enviar mensagem:", error);
          return "Desculpe, ocorreu um erro ao processar sua mensagem.";
        }
      }

      // Fun√ß√£o para enviar mensagem
      async function handleSendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;

        // Adicionar mensagem do usu√°rio
        addMessage(message, true);
        messageInput.value = "";
        sendButton.classList.remove("visible");

        // Mostrar loading
        const loadingDiv = document.createElement("div");
        loadingDiv.className = "message bot-message";
        loadingDiv.innerHTML = '<span class="loading"></span> Processando...';
        chatContainer.appendChild(loadingDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // Enviar para o webhook
        const response = await sendMessage(message);

        // Remover loading
        chatContainer.removeChild(loadingDiv);

        // Adicionar resposta do bot
        addMessage(response);
      }

      // Event listeners
      sendButton.addEventListener("click", handleSendMessage);

      messageInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          handleSendMessage();
        }
      });

      // Focar no input ao carregar a p√°gina
      messageInput.focus();
    </script>
  </body>
</html>
